name: Minerva QCB CI/Mint Test

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]
  workflow_dispatch: # Allows manual running from GitHub Actions tab

jobs:
  test_and_mint:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository and Submodules
        uses: actions/checkout@v4
        with:
          submodules: true # Ensures Wunjo and other modules are available
          
      - name: Set up Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          
      - name: Install Critical Dependencies
        # Only install ecdsa for signing, which is essential for the script to run
        run: pip install ecdsa
        
      - name: ðŸš¨ Minerva Chain Validation and Dry Run Mint
        run: |
          # The script is run to check if it initializes, creates Genesis, and attempts to mint.
          # The Wunjo command inside the script will fail unless the submodule is fully set up, 
          # but the Python logic will be fully tested.
          echo "::group::Running QCB Logic Test"
          python src/minerva_chain.py --agent 0xCI_TEST_AGENT_00000000000000000000000000000000
          echo "::endgroup::"
          
      - name: Show Final Status
        run: |
          echo "âœ… CI PASS: Python logic is sound."
          echo "Note: Wunjo media generation is mocked/skipped in CI."

